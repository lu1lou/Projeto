# -*- coding: utf-8 -*-
"""
Created on Sun May 25 16:16:59 2025

@author: luisl
"""

from graphics import *
import time

# 
def draw_station(win, label, p1, p2, color):
    rect = Rectangle(p1, p2)
    rect.setFill(color)
    rect.draw(win)
    Text(rect.getCenter(), label).draw(win)
    return rect

def draw_layout(win):
    kitchen = draw_station(win, "å‡ºé¤å¤„", Point(30, 30), Point(100, 90), "lightgreen")
    standby = draw_station(win, "å¾…å‘½åŒº", Point(30, 310), Point(100, 370), "lightblue")
    table1 = draw_station(win, "æ¡Œå­1", Point(380, 30), Point(450, 90), "lightyellow")
    table2 = draw_station(win, "æ¡Œå­2", Point(380, 130), Point(450, 190), "lightyellow")
    table3 = draw_station(win, "æ¡Œå­3", Point(380, 250), Point(450, 310), "lightyellow")
    return standby, kitchen, {'æ¡Œå­1': table1, 'æ¡Œå­2': table2, 'æ¡Œå­3': table3}

def draw_obstacles(win):
    obs1 = Rectangle(Point(200, 100), Point(250, 200))
    obs1.setFill("gray")
    obs1.draw(win)
    obs2 = Rectangle(Point(180, 250), Point(230, 300))
    obs2.setFill("gray")
    obs2.draw(win)

def draw_exit_button(win):
    button = Rectangle(Point(400, 360), Point(490, 390))
    button.setFill("red")
    button.draw(win)
    label = Text(button.getCenter(), "é€€å‡ºæ¸¸æˆ")
    label.setTextColor("white")
    label.draw(win)
    return button

def point_inside(rect, point):
    return rect.getP1().getX() <= point.getX() <= rect.getP2().getX() and \
           rect.getP1().getY() <= point.getY() <= rect.getP2().getY()

def move_servant(servant, points, delay=0.006):
    for i in range(len(points) - 1):
        start = points[i]
        end = points[i + 1]
        dx = end.getX() - start.getX()
        dy = end.getY() - start.getY()
        steps = int(max(abs(dx), abs(dy)))
        for _ in range(steps):
            servant.move(dx / steps, dy / steps)
            time.sleep(delay)

def main():
    win = GraphWin("æœåŠ¡ç”Ÿå¤šæ¡Œé€é¤æ¨¡æ‹Ÿ", 500, 400)
    win.setBackground("white")

    p1,p2 = Point(130, 340), Point(130, 60)
    p1.draw(win)
    p2.draw(win)


    standby, kitchen, tables = draw_layout(win)
    draw_obstacles(win)
    exit_button = draw_exit_button(win)

    servant = Circle(standby.getCenter(), 10)
    servant.setFill("blue")
    servant.draw(win)

    tip = Text(Point(250, 380), "ç‚¹å‡»ä»»æ„æ¡Œå­é€é¤ï¼ˆæ”¯æŒå¤šæ¬¡ï¼‰")
    tip.draw(win)

    while True:
        click = win.getMouse()

        if point_inside(exit_button, click):
            break

        target_table = None
        for name, rect in tables.items():
            if point_inside(rect, click):
                target_table = name
                break

        if target_table:
            tip.setText(f"ğŸš¶ æ­£åœ¨é€é¤åˆ° {target_table}...")

            # è®¾ç½®è·¯å¾„ï¼ˆæ ¹æ®ä¸åŒæ¡Œå­ä½ç½®ï¼‰
            current_pos = servant.getCenter()
            path_to_kitchen = [
                current_pos,          # Onde o servo estÃ¡ agora
                Point(130, 340),      # Desce para evitar obstÃ¡culos
                Point(130, 60),       # Vai para perto da cozinha
                kitchen.getCenter(),  # Chega ao centro da cozinha
            ]

            path_from_kitchen = [
                kitchen.getCenter(),  # Sai da cozinha
                Point(130, 60),       # Volta ao ponto de passagem
            ]
            
            if target_table == 'æ¡Œå­1':
                path_from_kitchen += [Point(280, 60), Point(415, 60)]
            elif target_table == 'æ¡Œå­2':
                path_from_kitchen += [Point(280, 60), Point(280, 160), Point(415, 160)]
            elif target_table == 'æ¡Œå­3':
                path_from_kitchen += [Point(130, 250), Point(300, 250), Point(415, 280)]
                
            # 1. Movimento atÃ© a cozinha
            move_servant(servant, path_to_kitchen)
            
            # (Aqui poderia ter uma pausa para "pegar a comida")
            time.sleep(2)  # Simula o tempo de carregamento
            
            # 2. Movimento de volta ao ponto (130, 60)
            move_servant(servant, path_from_kitchen)
          

            time.sleep(2)  # æ¨¡æ‹Ÿé€é¤æ—¶é—´

            # å›å¾…å‘½åŒº
            tip.setText("âœ… é€è¾¾ï¼Œè¿”å›å¾…å‘½åŒº...")
            back_path = [
                servant.getCenter(),
                Point(280, 340),
                Point(130, 340),
                standby.getCenter()
            ]
            move_servant(servant, back_path)

            tip.setText("ç‚¹å‡»æ¡Œå­ç»§ç»­é€é¤ / ç‚¹é€€å‡ºæŒ‰é’®ç»“æŸ")
        else:
            tip.setText("è¯·ç‚¹å‡»é»„è‰²æ¡Œå­è¿›è¡Œé€é¤")

    win.close()

main()
